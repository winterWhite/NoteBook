# 第1章：简介

MongoDB是面向文档的数据库，而非关系型数据库；其基本思路是将原本的“行”概念换成更加灵活的“文档”模型，这种方式可以将文档或者数组内嵌进来，可实现一条记录就可以表示非常复杂的层次关系；MongoDB所采用的面向文档的数据模型使其可以自动在多台服务器之间分割数据，还可以平衡集群的数据和负载，自动重排文档，十分有利于扩展；MongoDB具有丰富的功能，如索引功能、存储javascript、聚合、固定集合、文件存储等等；另外MongoDB具有卓越的性能且简化了数据库的管理。

# 第2章：入门

## 2.1 文档

文档是MongoDB中数据的基本单元，有些类似于关系数据库中的行（但比行更复杂），多个键及其关联的值有序的放在一起就是文档，在javascript里将文档表示为对象，如下：

	{"greeting": "Hello World!"}
这个文档只包含一个键值对，但通常的情况下一个文档包含多个键值对。

* 文档中的键值对是有序的，也就是说如果排列不一样，而内容一样的文档也是不一样的文档。如

		{"greeting": "Hello World!", "foo": 1}
		{"foo": 1, "greeting": "Hello World!"}
上面两个文档是不一样的。
* 文档键的值可是是各种数据类型
* 键不能含有\0（空字符），这个字符用于表示键的结尾
* .和$有特殊意义，只有在特定环境下才能使用
* 以下划线_开头的键是保留的，但不严格要求

MongoDB不但区分类型，也区分大小写，且MongoDB不能有重复的键。

## 2.2 集合

集合就是一组文档。如果文档相当于行，那么集合就相当于表

### 2.2.1 无模式

集合是无模式的，这意味着集合中的文档可以是各式各样的，但是在正是使用时还是要对文档进行分类和划分模式，这样便于管理和查询。

### 2.2.2 命名

集合名必须满足以下条件：
1. 集合名不能是空字符串""
2. 集合名不能含有\0空字符，此字符表示集合名的结尾
3. 集合名不能以“system.”开头，这是为系统集合保留的前缀
4. 用户创建的集合名字不能含有保留字符$

**子集合**：组织集合的一种惯例是使用“.”字符分开的按命名空间划分的子集。

## 2.3 数据库

MongoDB中多个文档组成集合，而多个集合组成数据库。一个MongoDB实例可承载多个数据库，且相互之间是独立的，都有独立的权限控制，放置在不同的文件中。

数据库名必须满足以下条件：
1. 不能是空字符
2. 不能含有' '(空格)、.、$、/、\、和\0
3. 应全部小写
4. 最多64字节

数据库名最终都会变为文件名，一些数据库名是保留的，如admin(root数据库)、local、config；将数据库的名字放到集合的前面使用.分隔开，则是集合的完全限定名，成为命名空间。

## 2.4 启动MongoDB

运行mongod.exe即可，默认情况下mongod会使用数据目录/data/db，并使用27017端口，如果数据目录不存在或不可写，服务器就会启动失败，所以在启动之前应先建立数据目录并保留对该目录的写权限。此外，mongod还会启动基本的HTTP服务器并监听端口28017，因此可通过http://localhost:28017来获取数据库管理信息。

## 2.5 MongoDB shell

MongoDB自带一个javascript shell，可以从命令行与MongoDB实例交互。启动方式，在命令行键入./mongo即可，必须保证在启动shell之前已经启动MongoDB。在shell中可以运行任何javascript程序，也可以调用定义javascript函数。

此外shell还提供类似SQL的语法操作：

	use dbname //使用dbname数据库，使用中的数据库有db指针指向

四种基本操作：

* 创建

	使用insert函数可添加文档到集合里：

		post = {
			"title": "My Blog",
			"content": "This is my blog."
			...
		}
		db.blog.insert(post)
* 读取

	find方法用于读取集合里所有的文档，若只想查看一个文档可使用方法findOne：

		db.blog.find()
	find和findOne可接受查询文档形式的限定条件。
* 更新

	update用于更新，其接收（至少）两个参数：
	1. 更新文档的限定条件
	2. 新的文档
* 删除

	remove用于从数据库中永久地删除文档，如果不使用参数，他也会删除一个集合中的所有文档

## 2.6 数据类型

### 2.6.1 基本数据类型

